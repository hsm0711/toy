<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Cron Expression 분석기</title>
    <th:block layout:fragment="extra-css">
        <link rel="stylesheet" th:href="@{/css/tool-page.css}">
        <link rel="stylesheet" th:href="@{/css/components.css}">
        <style>
            .result-value {
                white-space: pre-wrap;
            }
        </style>
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <div class="tool-container">
            <div class="page-header">
                <h2>⏰ Cron 표현식 분석기</h2>
                <p class="description">Cron 표현식을 분석하거나 생성합니다.</p>
            </div>

            <!-- Cron Expression Parser -->
            <div class="tool-section card">
                <h3>Cron 표현식 → 한글 설명</h3>
                <div class="input-group">
                    <label>Cron 표현식 입력</label>
                    <input type="text" id="cronInput" placeholder="예: 0 0 12 * * ?">
                    <div class="helper-text">Spring Cron (6필드) 또는 Unix Cron (5필드) 지원</div>
                </div>
                <button class="btn btn-primary" onclick="describeCron()">분석하기</button>
                <div id="describeResult" class="result-box">
                    <div class="result-item">
                        <div class="result-label">표현식</div>
                        <div class="result-value" id="resultExpression"></div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">타입</div>
                        <div class="result-value" id="resultType"></div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">설명</div>
                        <div class="result-value" id="resultDescription"></div>
                    </div>
                </div>
            </div>

            <!-- Cron Expression Generator -->
            <div class="tool-section card">
                <h3>Cron 표현식 생성기</h3>
                <div class="input-group">
                    <label>타입 선택</label>
                    <select id="cronType" onchange="toggleSecondField()">
                        <option value="spring">Spring Cron (6 필드)</option>
                        <option value="unix">Unix Cron (5 필드)</option>
                    </select>
                </div>
                
                <div class="grid-3">
                    <div class="input-group" id="secondField">
                        <label>초 (0-59)</label>
                        <input type="text" id="second" placeholder="* or 0">
                    </div>
                    <div class="input-group">
                        <label>분 (0-59)</label>
                        <input type="text" id="minute" placeholder="* or 0">
                    </div>
                    <div class="input-group">
                        <label>시 (0-23)</label>
                        <input type="text" id="hour" placeholder="* or 0">
                    </div>
                </div>
                
                <div class="grid-3">
                    <div class="input-group">
                        <label>일 (1-31)</label>
                        <input type="text" id="day" placeholder="* or 1">
                    </div>
                    <div class="input-group">
                        <label>월 (1-12)</label>
                        <input type="text" id="month" placeholder="* or 1">
                    </div>
                    <div class="input-group">
                        <label>요일 (0-7)</label>
                        <input type="text" id="weekday" placeholder="* or ? or 0">
                        <div class="helper-text">0,7=일요일, 1=월요일</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="generateCron()">생성하기</button>
                <div id="generateResult" class="result-box">
                    <div class="result-item">
                        <div class="result-label">생성된 Cron 표현식</div>
                        <div class="result-value" id="generatedExpression"></div>
                    </div>
                </div>
            </div>

            <!-- Examples -->
            <div class="examples" style="background: #d1ecf1;">
                <h4 style="color: #0c5460;">자주 사용하는 Cron 표현식 예제</h4>
                <div class="example-item" onclick="fillCronExample('0 0 12 * * ?')">0 0 12 * * ? - 매일 정오 12시</div>
                <div class="example-item" onclick="fillCronExample('0 */15 * * * ?')">0 */15 * * * ? - 15분마다</div>
                <div class="example-item" onclick="fillCronExample('0 0 9-18 * * MON-FRI')">0 0 9-18 * * MON-FRI - 평일 9시~18시 매 정각</div>
                <div class="example-item" onclick="fillCronExample('0 0 0 1 * ?')">0 0 0 1 * ? - 매월 1일 자정</div>
                <div class="example-item" onclick="fillCronExample('0 0 2 * * SUN')">0 0 2 * * SUN - 매주 일요일 새벽 2시</div>
            </div>
            
            <div id="errorMessage" class="error-message"></div>
        </div>
    </div>

    <th:block layout:fragment="extra-js">
        <script th:src="@{/js/common-utils.js}"></script>
        
        <script>
            function toggleSecondField() {
                const cronType = document.getElementById('cronType').value;
                const secondField = document.getElementById('secondField');
                secondField.style.display = cronType === 'spring' ? 'block' : 'none';
            }

            async function describeCron() {
                const expression = document.getElementById('cronInput').value;
                
                if (!ValidationUtils.validateRequired('cronInput', 'Cron 표현식을 입력하세요.')) {
                    return;
                }
                
                try {
                    UiUtils.hideError();
                    const data = await ApiClient.postJson('/cron-expression/api/describe', { expression: expression });
                    
                    if (data.success) {
                        document.getElementById('resultExpression').textContent = data.expression;
                        document.getElementById('resultType').textContent = data.type;
                        document.getElementById('resultDescription').textContent = data.description;
                        UiUtils.show('describeResult');
                    } else {
                        UiUtils.showError(data.message);
                    }
                } catch (error) {
                    console.error('분석 오류:', error);
                    UiUtils.showError('분석 중 오류가 발생했습니다.');
                }
            }

            async function generateCron() {
                const type = document.getElementById('cronType').value;
                const second = document.getElementById('second').value;
                const minute = document.getElementById('minute').value;
                const hour = document.getElementById('hour').value;
                const day = document.getElementById('day').value;
                const month = document.getElementById('month').value;
                const weekday = document.getElementById('weekday').value;
                
                try {
                    UiUtils.hideError();
                    const params = new URLSearchParams({
                        type: type,
                        second: second || '',
                        minute: minute || '',
                        hour: hour || '',
                        day: day || '',
                        month: month || '',
                        weekday: weekday || ''
                    });
                    
                    const response = await fetch(`/cron-expression/api/generate?${params}`, {
                        method: 'POST'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        document.getElementById('generatedExpression').textContent = data.expression;
                        UiUtils.show('generateResult');
                    } else {
                        UiUtils.showError(data.message);
                    }
                } catch (error) {
                    console.error('생성 오류:', error);
                    UiUtils.showError('생성 중 오류가 발생했습니다.');
                }
            }

            function fillCronExample(expression) {
                document.getElementById('cronInput').value = expression;
                describeCron();
            }
        </script>
    </th:block>
</body>
</html>