<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>URL ì•ˆì „ì„± ê²€ì¦</title>
    <th:block layout:fragment="extra-css">
        <link rel="stylesheet" th:href="@{/css/tool-page.css}">
        <link rel="stylesheet" th:href="@{/css/components.css}">
        <style>
            .risk-badge {
                display: inline-block;
                padding: 0.5rem 1rem;
                border-radius: 20px;
                font-weight: 600;
                font-size: 1.1rem;
                margin: 1rem 0;
            }
            
            .risk-safe {
                background: #d4edda;
                color: #155724;
                border: 2px solid #28a745;
            }
            
            .risk-low {
                background: #d1ecf1;
                color: #0c5460;
                border: 2px solid #17a2b8;
            }
            
            .risk-medium {
                background: #fff3cd;
                color: #856404;
                border: 2px solid #ffc107;
            }
            
            .risk-high {
                background: #f8d7da;
                color: #721c24;
                border: 2px solid #dc3545;
            }
            
            .recommendation-box {
                padding: 1.5rem;
                border-radius: 10px;
                margin: 1.5rem 0;
                font-size: 1.1rem;
                font-weight: 500;
            }
            
            .recommendation-safe {
                background: #d4edda;
                color: #155724;
                border-left: 5px solid #28a745;
            }
            
            .recommendation-low {
                background: #d1ecf1;
                color: #0c5460;
                border-left: 5px solid #17a2b8;
            }
            
            .recommendation-medium {
                background: #fff3cd;
                color: #856404;
                border-left: 5px solid #ffc107;
            }
            
            .recommendation-high {
                background: #f8d7da;
                color: #721c24;
                border-left: 5px solid #dc3545;
            }
            
            .checks-section, .warnings-section {
                background: white;
                padding: 1.5rem;
                border-radius: 10px;
                margin: 1rem 0;
            }
            
            .checks-section h4 {
                color: #28a745;
                margin-bottom: 1rem;
            }
            
            .warnings-section h4 {
                color: #dc3545;
                margin-bottom: 1rem;
            }
            
            .check-item, .warning-item {
                padding: 0.5rem 0;
                border-bottom: 1px solid #e9ecef;
            }
            
            .check-item:last-child, .warning-item:last-child {
                border-bottom: none;
            }
            
            .score-display {
                font-size: 3rem;
                font-weight: 700;
                text-align: center;
                margin: 1rem 0;
            }
            
            .score-safe { color: #28a745; }
            .score-low { color: #17a2b8; }
            .score-medium { color: #ffc107; }
            .score-high { color: #dc3545; }
            
            .info-box {
                background: #e7f3ff;
                padding: 1rem;
                border-radius: 8px;
                border-left: 4px solid #007bff;
                margin: 1rem 0;
            }
            
            .info-box h4 {
                color: #004085;
                margin-bottom: 0.5rem;
            }
            
            .info-box ul {
                margin: 0.5rem 0 0 1.5rem;
            }
            
            .info-box li {
                margin: 0.25rem 0;
            }
        </style>
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <div class="tool-container">
            <div class="page-header">
                <h2>ğŸ”’ URL ì•ˆì „ì„± ê²€ì¦</h2>
                <p class="description">URLì´ í”¼ì‹±ì´ë‚˜ ì‚¬ê¸° ì‚¬ì´íŠ¸ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="info-box">
                <h4>ì´ ë„êµ¬ëŠ” ë¬´ì—‡ì„ í™•ì¸í•˜ë‚˜ìš”?</h4>
                <ul>
                    <li>âœ“ HTTPS ì‚¬ìš© ì—¬ë¶€</li>
                    <li>âœ“ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë„ë©”ì¸ íŒ¨í„´</li>
                    <li>âœ“ ìœ ëª… ë¸Œëœë“œ ëª¨ë°© ì—¬ë¶€</li>
                    <li>âœ“ URL ë‹¨ì¶• ì„œë¹„ìŠ¤ ì‚¬ìš©</li>
                    <li>âœ“ í”¼ì‹± ê´€ë ¨ í‚¤ì›Œë“œ</li>
                    <li>âœ“ ë¹„ì •ìƒì ì¸ URL êµ¬ì¡°</li>
                </ul>
            </div>

            <div class="tool-section card">
                <div class="input-group">
                    <label>ê²€ì¦í•  URL ì…ë ¥</label>
                    <input type="text" id="urlInput" placeholder="ì˜ˆ: https://example.com">
                    <div class="helper-text">http:// ë˜ëŠ” https:// í¬í•¨ ë˜ëŠ” ìƒëµ ê°€ëŠ¥</div>
                </div>
                <button class="btn btn-primary" onclick="validateUrl()">ê²€ì¦í•˜ê¸°</button>
                
                <div id="resultArea" style="display: none; margin-top: 2rem;">
                    <!-- ìœ„í—˜ë„ ì ìˆ˜ -->
                    <div style="text-align: center;">
                        <div id="riskBadge" class="risk-badge"></div>
                        <div id="scoreDisplay" class="score-display"></div>
                        <p style="color: #6c757d;">ìœ„í—˜ë„ ì ìˆ˜ (0-100)</p>
                    </div>
                    
                    <!-- ê¶Œì¥ì‚¬í•­ -->
                    <div id="recommendationBox" class="recommendation-box"></div>
                    
                    <!-- ê²€ì¦ í•­ëª© -->
                    <div class="checks-section" id="checksSection">
                        <h4>âœ… í†µê³¼í•œ ê²€ì‚¬</h4>
                        <div id="checksList"></div>
                    </div>
                    
                    <!-- ê²½ê³  í•­ëª© -->
                    <div class="warnings-section" id="warningsSection" style="display: none;">
                        <h4>âš ï¸ ë°œê²¬ëœ ê²½ê³ </h4>
                        <div id="warningsList"></div>
                    </div>
                    
                    <!-- URL ì •ë³´ -->
                    <div class="result-box">
                        <div class="result-item">
                            <span class="result-label">ê²€ì¦ëœ URL</span>
                            <span class="result-value" id="checkedUrl"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">í˜¸ìŠ¤íŠ¸</span>
                            <span class="result-value" id="hostName"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="examples" style="background: #fff3cd;">
                <h4 style="color: #856404;">í…ŒìŠ¤íŠ¸ ì˜ˆì œ (ì•ˆì „í•œ ì‚¬ì´íŠ¸)</h4>
                <div class="example-item" onclick="fillExample('https://google.com')">https://google.com</div>
                <div class="example-item" onclick="fillExample('https://github.com')">https://github.com</div>
                <div class="example-item" onclick="fillExample('https://naver.com')">https://naver.com</div>
            </div>

            <div class="examples" style="background: #f8d7da;">
                <h4 style="color: #721c24;">âš ï¸ ì£¼ì˜: ì˜ì‹¬ìŠ¤ëŸ¬ìš´ íŒ¨í„´ ì˜ˆì œ</h4>
                <div class="example-item" onclick="fillExample('http://192.168.1.1/login')">http://192.168.1.1/login - IP ì£¼ì†Œ ì‚¬ìš©</div>
                <div class="example-item" onclick="fillExample('http://paypal-verify-account.tk')">http://paypal-verify-account.tk - ì˜ì‹¬ìŠ¤ëŸ¬ìš´ TLD</div>
                <div class="example-item" onclick="fillExample('http://google-login-secure.com')">http://google-login-secure.com - ë¸Œëœë“œ ëª¨ë°©</div>
            </div>
            
            <div id="errorMessage" class="error-message"></div>
        </div>
    </div>

    <th:block layout:fragment="extra-js">
        <script th:src="@{/js/common-utils.js}"></script>
        
        <script>
            async function validateUrl() {
                const url = document.getElementById('urlInput').value;
                
                if (!ValidationUtils.validateRequired('urlInput', 'URLì„ ì…ë ¥í•˜ì„¸ìš”.')) {
                    return;
                }
                
                try {
                    UiUtils.hideError();
                    const data = await ApiClient.postJson('/url-validator/api/validate', { url: url });
                    
                    if (data.success) {
                        displayResults(data);
                    } else {
                        UiUtils.showError(data.message);
                    }
                } catch (error) {
                    console.error('URL ê²€ì¦ ì˜¤ë¥˜:', error);
                    UiUtils.showError('ê²€ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }

            function displayResults(data) {
                const resultArea = document.getElementById('resultArea');
                const riskBadge = document.getElementById('riskBadge');
                const scoreDisplay = document.getElementById('scoreDisplay');
                const recommendationBox = document.getElementById('recommendationBox');
                const checksList = document.getElementById('checksList');
                const warningsList = document.getElementById('warningsList');
                const warningsSection = document.getElementById('warningsSection');
                
                // ìœ„í—˜ë„ ë ˆë²¨ì— ë”°ë¥¸ í´ë˜ìŠ¤
                let riskClass, scoreClass, recClass;
                switch(data.riskLevel) {
                    case 'HIGH_RISK':
                        riskClass = 'risk-high';
                        scoreClass = 'score-high';
                        recClass = 'recommendation-high';
                        riskBadge.textContent = 'ğŸš¨ ê³ ìœ„í—˜';
                        break;
                    case 'MEDIUM_RISK':
                        riskClass = 'risk-medium';
                        scoreClass = 'score-medium';
                        recClass = 'recommendation-medium';
                        riskBadge.textContent = 'âš ï¸ ì¤‘ìœ„í—˜';
                        break;
                    case 'LOW_RISK':
                        riskClass = 'risk-low';
                        scoreClass = 'score-low';
                        recClass = 'recommendation-low';
                        riskBadge.textContent = 'â„¹ï¸ ì €ìœ„í—˜';
                        break;
                    default:
                        riskClass = 'risk-safe';
                        scoreClass = 'score-safe';
                        recClass = 'recommendation-safe';
                        riskBadge.textContent = 'âœ… ì•ˆì „';
                }
                
                riskBadge.className = 'risk-badge ' + riskClass;
                scoreDisplay.textContent = data.riskScore;
                scoreDisplay.className = 'score-display ' + scoreClass;
                
                // ê¶Œì¥ì‚¬í•­
                recommendationBox.textContent = data.recommendation;
                recommendationBox.className = 'recommendation-box ' + recClass;
                
                // í†µê³¼í•œ ê²€ì‚¬
                checksList.innerHTML = data.checks.map(check => 
                    `<div class="check-item">${HtmlUtils.escape(check)}</div>`
                ).join('');
                
                // ê²½ê³  í•­ëª©
                if (data.warnings && data.warnings.length > 0) {
                    warningsList.innerHTML = data.warnings.map(warning => 
                        `<div class="warning-item">${HtmlUtils.escape(warning)}</div>`
                    ).join('');
                    warningsSection.style.display = 'block';
                } else {
                    warningsSection.style.display = 'none';
                }
                
                // URL ì •ë³´
                document.getElementById('checkedUrl').textContent = data.url;
                document.getElementById('hostName').textContent = data.host;
                
                UiUtils.show('resultArea');
            }

            function fillExample(url) {
                document.getElementById('urlInput').value = url;
                validateUrl();
            }
        </script>
    </th:block>
</body>
</html>