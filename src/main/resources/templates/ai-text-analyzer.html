<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>AI í…ìŠ¤íŠ¸ ë¶„ì„</title>
    <th:block layout:fragment="extra-css">
        <link rel="stylesheet" th:href="@{/css/tool-page.css}">
        <link rel="stylesheet" th:href="@{/css/components.css}">
        <style>
            .analysis-output {
                background: white;
                padding: 1.5rem;
                border-radius: 10px;
                margin-top: 1.5rem;
                border: 2px solid #e2e8f0;
                min-height: 200px;
                white-space: pre-wrap;
                line-height: 1.8;
                display: none;
            }
            
            .analysis-output.show {
                display: block;
                animation: fadeIn 0.5s;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            .usage-badge {
                display: inline-block;
                padding: 0.5rem 1rem;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 20px;
                font-size: 0.85rem;
                font-weight: 600;
                margin-bottom: 1rem;
            }
            
            .info-box {
                background: #e7f3ff;
                border-left: 4px solid #667eea;
                padding: 1rem;
                margin: 1rem 0;
                border-radius: 6px;
            }
            
            .info-box strong {
                color: #004085;
            }
            
            .analysis-tabs {
                display: flex;
                gap: 0.5rem;
                margin-bottom: 1.5rem;
                flex-wrap: wrap;
            }
            
            .tab-button {
                padding: 0.75rem 1.5rem;
                border: 2px solid #e2e8f0;
                background: white;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s;
                font-weight: 500;
            }
            
            .tab-button:hover {
                border-color: #667eea;
                background: #f7faff;
            }
            
            .tab-button.active {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-color: #667eea;
            }
            
            .char-count {
                text-align: right;
                font-size: 0.85rem;
                color: #6c757d;
                margin-top: 0.5rem;
            }
            
            .streaming-indicator {
                display: none;
                align-items: center;
                gap: 0.5rem;
                color: #667eea;
                font-weight: 500;
                margin-top: 1rem;
            }
            
            .streaming-indicator.show {
                display: flex;
            }
            
            .streaming-dot {
                width: 8px;
                height: 8px;
                background: #667eea;
                border-radius: 50%;
                animation: pulse 1.5s infinite;
            }
            
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.3; }
            }
        </style>
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <div class="tool-container">
            <div class="page-header">
                <h2>âœ¨ AI í…ìŠ¤íŠ¸ ë¶„ì„ê¸°</h2>
                <p class="description">Hugging Face AIê°€ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ìš”ì•½í•©ë‹ˆë‹¤.</p>
                <div class="usage-badge">ğŸ¤– ë¬´ë£Œ - Hugging Face API</div>
            </div>

            <div class="info-box">
                <strong>âœ… ë¬´ë£Œ API:</strong> Hugging Face Inference API (ë¬´ë£Œ í‹°ì–´) ì‚¬ìš©<br>
                <strong>ğŸ¤– AI ëª¨ë¸:</strong> BART (ìš”ì•½), DistilBERT (ê°ì •), OPUS-MT (ë²ˆì—­) ë“±<br>
                <strong>âš¡ ë¹ ë¥¸ ì²˜ë¦¬:</strong> ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ì–´ ë¹ ë¥´ê³  ì•ˆì •ì ì…ë‹ˆë‹¤
            </div>

            <div class="tool-section card">
                <h3>ë¶„ì„ ìœ í˜• ì„ íƒ</h3>
                <div class="analysis-tabs">
                    <button class="tab-button active" data-type="summary" onclick="selectAnalysisType('summary')">
                        ğŸ“ ìš”ì•½
                    </button>
                    <button class="tab-button" data-type="keywords" onclick="selectAnalysisType('keywords')">
                        ğŸ”‘ í‚¤ì›Œë“œ ì¶”ì¶œ
                    </button>
                    <button class="tab-button" data-type="sentiment" onclick="selectAnalysisType('sentiment')">
                        ğŸ˜Š ê°ì • ë¶„ì„
                    </button>
                    <button class="tab-button" data-type="translate" onclick="selectAnalysisType('translate')">
                        ğŸŒ ë²ˆì—­ (ì˜â†’í•œ)
                    </button>
                    <button class="tab-button" data-type="improve" onclick="selectAnalysisType('improve')">
                        âœï¸ ë¬¸ì¥ ê°œì„ 
                    </button>
                    <button class="tab-button" data-type="explain" onclick="selectAnalysisType('explain')">
                        ğŸ’¡ ì‰¬ìš´ ì„¤ëª…
                    </button>
                </div>

                <div class="input-group">
                    <label>ë¶„ì„í•  í…ìŠ¤íŠ¸ ì…ë ¥</label>
                    <textarea id="textInput" placeholder="ì—¬ê¸°ì— í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="min-height: 200px;" oninput="updateCharCount()"></textarea>
                    <div class="char-count" id="charCount">0 ê¸€ì</div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="analyzeText()" id="analyzeBtn">
                        <span id="analyzeBtnText">âœ¨ AI ë¶„ì„ ì‹œì‘</span>
                    </button>
                    <button class="btn btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
                </div>

                <div class="streaming-indicator" id="streamingIndicator">
                    <div class="streaming-dot"></div>
                    <span>AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</span>
                </div>

                <div class="analysis-output" id="analysisOutput"></div>
            </div>

            <div class="examples" style="background: #e7f3ff;">
                <h4 style="color: #004085;">ğŸ’¡ ì˜ˆì œ í…ìŠ¤íŠ¸ (í´ë¦­í•˜ì—¬ ì…ë ¥)</h4>
                <div class="example-item" onclick="fillExample('article')">
                    ğŸ“° ê¸´ ê¸°ì‚¬ ìš”ì•½ ì˜ˆì œ
                </div>
                <div class="example-item" onclick="fillExample('email')">
                    ğŸ“§ ì´ë©”ì¼ ë¬¸ì¥ ê°œì„  ì˜ˆì œ
                </div>
                <div class="example-item" onclick="fillExample('review')">
                    â­ ë¦¬ë·° ê°ì • ë¶„ì„ ì˜ˆì œ
                </div>
            </div>
            
            <div id="errorMessage" class="error-message"></div>
        </div>
    </div>

    <th:block layout:fragment="extra-js">
        <script th:src="@{/js/common-utils.js}"></script>
        
        <script>
            let currentAnalysisType = 'summary';

            function selectAnalysisType(type) {
                currentAnalysisType = type;
                
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-type="${type}"]`).classList.add('active');
                
                const btnTexts = {
                    'summary': 'ğŸ“ ìš”ì•½í•˜ê¸°',
                    'keywords': 'ğŸ”‘ í‚¤ì›Œë“œ ì¶”ì¶œ',
                    'sentiment': 'ğŸ˜Š ê°ì • ë¶„ì„',
                    'translate': 'ğŸŒ ë²ˆì—­í•˜ê¸°',
                    'improve': 'âœï¸ ë¬¸ì¥ ê°œì„ ',
                    'explain': 'ğŸ’¡ ì‰½ê²Œ ì„¤ëª…'
                };
                document.getElementById('analyzeBtnText').textContent = `âœ¨ ${btnTexts[type] || 'AI ë¶„ì„'}`;
            }

            function updateCharCount() {
                const text = document.getElementById('textInput').value;
                document.getElementById('charCount').textContent = `${text.length} ê¸€ì`;
                
                if (text.length > 5000) {
                    UiUtils.showError('í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. 5000ì ì´í•˜ë¡œ ì¤„ì—¬ì£¼ì„¸ìš”.');
                } else {
                    UiUtils.hideError();
                }
            }

            async function analyzeText() {
                const text = document.getElementById('textInput').value.trim();
                
                if (!text) {
                    UiUtils.showError('ë¶„ì„í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                
                if (text.length > 5000) {
                    UiUtils.showError('í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. 5000ì ì´í•˜ë¡œ ì¤„ì—¬ì£¼ì„¸ìš”.');
                    return;
                }
                
                const analyzeBtn = document.getElementById('analyzeBtn');
                const outputDiv = document.getElementById('analysisOutput');
                const streamingIndicator = document.getElementById('streamingIndicator');
                
                try {
                    UiUtils.hideError();
                    analyzeBtn.disabled = true;
                    analyzeBtn.textContent = 'â³ ë¶„ì„ ì¤‘...';
                    streamingIndicator.classList.add('show');
                    outputDiv.classList.remove('show');
                    outputDiv.textContent = '';
                    
                    // ì„œë²„ API í˜¸ì¶œ (Hugging Face Inference API)
                    const data = await ApiClient.postJson('/ai-text-analyzer/api/analyze', {
                        text: text,
                        analysisType: currentAnalysisType
                    });

                    if (data.success) {
                        outputDiv.textContent = data.result;
                        outputDiv.classList.add('show');
                        UiUtils.showSuccess('ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        UiUtils.showError(data.message || 'ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('AI ë¶„ì„ ì˜¤ë¥˜:', error);
                    UiUtils.showError('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                } finally {
                    analyzeBtn.disabled = false;
                    selectAnalysisType(currentAnalysisType);
                    streamingIndicator.classList.remove('show');
                }
            }

            function clearAll() {
                document.getElementById('textInput').value = '';
                document.getElementById('analysisOutput').textContent = '';
                document.getElementById('analysisOutput').classList.remove('show');
                updateCharCount();
                UiUtils.hideError();
            }

            function fillExample(type) {
                const examples = {
                    'article': `Artificial intelligence technology is rapidly advancing and bringing many changes to our daily lives. Natural language processing technology is being used in various fields such as translation, summarization, and conversation, and has now reached a level that is difficult to distinguish from humans.`,
                    
                    'email': `Hello. I am interested in your product and have a few questions. I would like to know how much it costs and when it will be shipped. Please reply quickly.`,
                    
                    'review': `This product is really great! The delivery was fast and the quality exceeded my expectations. The price-performance ratio is so good that I recommended it to my friends too. However, the manual seems a bit lacking. Overall, I am very satisfied. I will buy this brand's products again next time.`
                };
                
                document.getElementById('textInput').value = examples[type] || examples['article'];
                updateCharCount();
            }

            window.onload = function() {
                updateCharCount();
            };
        </script>
    </th:block>
</body>
</html>
