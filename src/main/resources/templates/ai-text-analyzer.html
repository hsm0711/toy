<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>AI í…ìŠ¤íŠ¸ ë¶„ì„</title>
    <th:block layout:fragment="extra-css">
        <link rel="stylesheet" th:href="@{/css/tool-page.css}">
        <link rel="stylesheet" th:href="@{/css/components.css}">
        <style>
            .analysis-output {
                background: white;
                padding: 1.5rem;
                border-radius: 10px;
                margin-top: 1.5rem;
                border: 2px solid #e2e8f0;
                min-height: 200px;
                white-space: pre-wrap;
                line-height: 1.8;
                display: none;
            }
            
            .analysis-output.show {
                display: block;
                animation: fadeIn 0.5s;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            .usage-badge {
                display: inline-block;
                padding: 0.5rem 1rem;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 20px;
                font-size: 0.85rem;
                font-weight: 600;
                margin-bottom: 1rem;
            }
            
            .usage-warning {
                background: #fff3cd;
                border-left: 4px solid #ffc107;
                padding: 1rem;
                margin: 1rem 0;
                border-radius: 6px;
                display: none;
            }
            
            .usage-warning.show {
                display: block;
            }
            
            .analysis-tabs {
                display: flex;
                gap: 0.5rem;
                margin-bottom: 1.5rem;
                flex-wrap: wrap;
            }
            
            .tab-button {
                padding: 0.75rem 1.5rem;
                border: 2px solid #e2e8f0;
                background: white;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s;
                font-weight: 500;
            }
            
            .tab-button:hover {
                border-color: #667eea;
                background: #f7faff;
            }
            
            .tab-button.active {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-color: #667eea;
            }
            
            .char-count {
                text-align: right;
                font-size: 0.85rem;
                color: #6c757d;
                margin-top: 0.5rem;
            }
            
            .streaming-indicator {
                display: none;
                align-items: center;
                gap: 0.5rem;
                color: #667eea;
                font-weight: 500;
                margin-top: 1rem;
            }
            
            .streaming-indicator.show {
                display: flex;
            }
            
            .streaming-dot {
                width: 8px;
                height: 8px;
                background: #667eea;
                border-radius: 50%;
                animation: pulse 1.5s infinite;
            }
            
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.3; }
            }
        </style>
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <div class="tool-container">
            <div class="page-header">
                <h2>âœ¨ AI í…ìŠ¤íŠ¸ ë¶„ì„ê¸°</h2>
                <p class="description">Claude AIê°€ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ê³  ìš”ì•½í•©ë‹ˆë‹¤.</p>
                <div class="usage-badge">ğŸ¤– ë¬´ë£Œ AI ë¶„ì„ - ì‚¬ìš©ëŸ‰ ë¬´ì œí•œ</div>
            </div>

            <div class="usage-warning" id="usageWarning">
                <strong>âš ï¸ ì£¼ì˜:</strong> AI ë¶„ì„ì€ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ìˆ˜í–‰ë˜ë©°, í° í…ìŠ¤íŠ¸ëŠ” ì²˜ë¦¬ ì‹œê°„ì´ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>

            <div class="tool-section card">
                <h3>ë¶„ì„ ìœ í˜• ì„ íƒ</h3>
                <div class="analysis-tabs">
                    <button class="tab-button active" data-type="summary" onclick="selectAnalysisType('summary')">
                        ğŸ“ ìš”ì•½
                    </button>
                    <button class="tab-button" data-type="keywords" onclick="selectAnalysisType('keywords')">
                        ğŸ”‘ í‚¤ì›Œë“œ ì¶”ì¶œ
                    </button>
                    <button class="tab-button" data-type="sentiment" onclick="selectAnalysisType('sentiment')">
                        ğŸ˜Š ê°ì • ë¶„ì„
                    </button>
                    <button class="tab-button" data-type="translate" onclick="selectAnalysisType('translate')">
                        ğŸŒ ë²ˆì—­ (ì˜â†’í•œ)
                    </button>
                    <button class="tab-button" data-type="improve" onclick="selectAnalysisType('improve')">
                        âœï¸ ë¬¸ì¥ ê°œì„ 
                    </button>
                    <button class="tab-button" data-type="explain" onclick="selectAnalysisType('explain')">
                        ğŸ’¡ ì‰¬ìš´ ì„¤ëª…
                    </button>
                </div>

                <div class="input-group">
                    <label>ë¶„ì„í•  í…ìŠ¤íŠ¸ ì…ë ¥</label>
                    <textarea id="textInput" placeholder="ì—¬ê¸°ì— í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="min-height: 200px;" oninput="updateCharCount()"></textarea>
                    <div class="char-count" id="charCount">0 ê¸€ì</div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="analyzeText()" id="analyzeBtn">
                        <span id="analyzeBtnText">âœ¨ AI ë¶„ì„ ì‹œì‘</span>
                    </button>
                    <button class="btn btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
                </div>

                <div class="streaming-indicator" id="streamingIndicator">
                    <div class="streaming-dot"></div>
                    <span>AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</span>
                </div>

                <div class="analysis-output" id="analysisOutput"></div>
            </div>

            <div class="examples" style="background: #e7f3ff;">
                <h4 style="color: #004085;">ğŸ’¡ ì˜ˆì œ í…ìŠ¤íŠ¸ (í´ë¦­í•˜ì—¬ ì…ë ¥)</h4>
                <div class="example-item" onclick="fillExample('article')">
                    ğŸ“° ê¸´ ê¸°ì‚¬ ìš”ì•½ ì˜ˆì œ
                </div>
                <div class="example-item" onclick="fillExample('email')">
                    ğŸ“§ ì´ë©”ì¼ ë¬¸ì¥ ê°œì„  ì˜ˆì œ
                </div>
                <div class="example-item" onclick="fillExample('review')">
                    â­ ë¦¬ë·° ê°ì • ë¶„ì„ ì˜ˆì œ
                </div>
            </div>
            
            <div id="errorMessage" class="error-message"></div>
        </div>
    </div>

    <th:block layout:fragment="extra-js">
        <script th:src="@{/js/common-utils.js}"></script>
        
        <script>
            let currentAnalysisType = 'summary';
            let requestCount = 0;
            const MAX_FREE_REQUESTS = 1000; // ë„‰ë„‰í•œ ì œí•œ

            function selectAnalysisType(type) {
                currentAnalysisType = type;
                
                // íƒ­ í™œì„±í™”
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-type="${type}"]`).classList.add('active');
                
                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
                const btnTexts = {
                    'summary': 'ğŸ“ ìš”ì•½í•˜ê¸°',
                    'keywords': 'ğŸ”‘ í‚¤ì›Œë“œ ì¶”ì¶œ',
                    'sentiment': 'ğŸ˜Š ê°ì • ë¶„ì„',
                    'translate': 'ğŸŒ ë²ˆì—­í•˜ê¸°',
                    'improve': 'âœï¸ ë¬¸ì¥ ê°œì„ ',
                    'explain': 'ğŸ’¡ ì‰½ê²Œ ì„¤ëª…'
                };
                document.getElementById('analyzeBtnText').textContent = `âœ¨ ${btnTexts[type] || 'AI ë¶„ì„'}`;
            }

            function updateCharCount() {
                const text = document.getElementById('textInput').value;
                document.getElementById('charCount').textContent = `${text.length} ê¸€ì`;
                
                if (text.length > 5000) {
                    UiUtils.showError('í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. 5000ì ì´í•˜ë¡œ ì¤„ì—¬ì£¼ì„¸ìš”.');
                } else {
                    UiUtils.hideError();
                }
            }

            async function analyzeText() {
                const text = document.getElementById('textInput').value.trim();
                
                if (!text) {
                    UiUtils.showError('ë¶„ì„í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                
                if (text.length > 5000) {
                    UiUtils.showError('í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. 5000ì ì´í•˜ë¡œ ì¤„ì—¬ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ì‚¬ìš©ëŸ‰ ì²´í¬ (ì„ íƒì )
                requestCount++;
                if (requestCount > MAX_FREE_REQUESTS) {
                    UiUtils.showError('ë¬´ë£Œ ì‚¬ìš© í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                const analyzeBtn = document.getElementById('analyzeBtn');
                const outputDiv = document.getElementById('analysisOutput');
                const streamingIndicator = document.getElementById('streamingIndicator');
                
                try {
                    UiUtils.hideError();
                    analyzeBtn.disabled = true;
                    analyzeBtn.textContent = 'â³ ë¶„ì„ ì¤‘...';
                    streamingIndicator.classList.add('show');
                    outputDiv.classList.remove('show');
                    outputDiv.textContent = '';
                    
                    // Claude API í˜¸ì¶œ
                    const prompt = buildPrompt(currentAnalysisType, text);
                    
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 2000,
                            messages: [
                                {
                                    role: "user",
                                    content: prompt
                                }
                            ]
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (!data.content || !data.content[0]) {
                        throw new Error('AI ì‘ë‹µì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    
                    const result = data.content[0].text;
                    
                    // ê²°ê³¼ í‘œì‹œ
                    outputDiv.textContent = result;
                    outputDiv.classList.add('show');
                    
                    UiUtils.showSuccess('ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    
                } catch (error) {
                    console.error('AI ë¶„ì„ ì˜¤ë¥˜:', error);
                    UiUtils.showError('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                } finally {
                    analyzeBtn.disabled = false;
                    selectAnalysisType(currentAnalysisType);
                    streamingIndicator.classList.remove('show');
                }
            }

            function buildPrompt(type, text) {
                const prompts = {
                    'summary': `ë‹¤ìŒ í…ìŠ¤íŠ¸ë¥¼ 3-5ë¬¸ì¥ìœ¼ë¡œ í•µì‹¬ë§Œ ê°„ê²°í•˜ê²Œ ìš”ì•½í•´ì£¼ì„¸ìš”:\n\n${text}`,
                    
                    'keywords': `ë‹¤ìŒ í…ìŠ¤íŠ¸ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ í‚¤ì›Œë“œ 10ê°œë¥¼ ì¶”ì¶œí•˜ê³ , ê° í‚¤ì›Œë“œì— ëŒ€í•´ ê°„ë‹¨íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”:\n\n${text}`,
                    
                    'sentiment': `ë‹¤ìŒ í…ìŠ¤íŠ¸ì˜ ê°ì •ì„ ë¶„ì„í•˜ê³  (ê¸ì •/ë¶€ì •/ì¤‘ë¦½), ê·¸ ì´ìœ ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”:\n\n${text}`,
                    
                    'translate': `ë‹¤ìŒ í…ìŠ¤íŠ¸ë¥¼ í•œêµ­ì–´ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë²ˆì—­í•´ì£¼ì„¸ìš”:\n\n${text}`,
                    
                    'improve': `ë‹¤ìŒ í…ìŠ¤íŠ¸ë¥¼ ë” ëª…í™•í•˜ê³  ì „ë¬¸ì ìœ¼ë¡œ ê°œì„ í•´ì£¼ì„¸ìš”. ì›ë˜ ì˜ë¯¸ëŠ” ìœ ì§€í•˜ë˜ ë¬¸ë²•, ì–´íœ˜, êµ¬ì¡°ë¥¼ ê°œì„ í•´ì£¼ì„¸ìš”:\n\n${text}`,
                    
                    'explain': `ë‹¤ìŒ í…ìŠ¤íŠ¸ë¥¼ ì¤‘í•™ìƒë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì‰½ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”. ì–´ë ¤ìš´ ìš©ì–´ëŠ” í’€ì–´ì„œ ì„¤ëª…í•´ì£¼ì„¸ìš”:\n\n${text}`
                };
                
                return prompts[type] || prompts['summary'];
            }

            function clearAll() {
                document.getElementById('textInput').value = '';
                document.getElementById('analysisOutput').textContent = '';
                document.getElementById('analysisOutput').classList.remove('show');
                updateCharCount();
                UiUtils.hideError();
            }

            function fillExample(type) {
                const examples = {
                    'article': `ì¸ê³µì§€ëŠ¥ ê¸°ìˆ ì´ ë¹ ë¥´ê²Œ ë°œì „í•˜ë©´ì„œ ìš°ë¦¬ ì¼ìƒìƒí™œì— ë§ì€ ë³€í™”ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ìì—°ì–´ ì²˜ë¦¬ ê¸°ìˆ ì€ ë²ˆì—­, ìš”ì•½, ëŒ€í™” ë“± ë‹¤ì–‘í•œ ë¶„ì•¼ì—ì„œ í™œìš©ë˜ê³  ìˆìœ¼ë©°, ì´ì œëŠ” ì‚¬ëŒê³¼ êµ¬ë¶„í•˜ê¸° ì–´ë ¤ìš¸ ì •ë„ì˜ ìˆ˜ì¤€ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŸ¬í•œ ê¸°ìˆ  ë°œì „ê³¼ í•¨ê»˜ ìœ¤ë¦¬ì  ë¬¸ì œ, ì¼ìë¦¬ ëŒ€ì²´ ìš°ë ¤, ê°œì¸ì •ë³´ ë³´í˜¸ ë“± ì—¬ëŸ¬ ê³¼ì œë„ í•¨ê»˜ ì œê¸°ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì „ë¬¸ê°€ë“¤ì€ AI ê¸°ìˆ ì´ ì¸ë¥˜ì—ê²Œ ë” ë‚˜ì€ ë¯¸ë˜ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ì„œëŠ” ê¸°ìˆ  ë°œì „ê³¼ í•¨ê»˜ ì ì ˆí•œ ê·œì œì™€ ìœ¤ë¦¬ ê¸°ì¤€ì´ ë§ˆë ¨ë˜ì–´ì•¼ í•œë‹¤ê³  ê°•ì¡°í•©ë‹ˆë‹¤.`,
                    
                    'email': `ì•ˆë…•í•˜ì„¸ìš”. ì €ëŠ” ê·€ì‚¬ì˜ ì œí’ˆì— ê´€ì‹¬ì´ ìˆì–´ì„œ ëª‡ ê°€ì§€ ì§ˆë¬¸ì´ ìˆìŠµë‹ˆë‹¤. ê°€ê²©ì´ ì–¼ë§ˆì¸ì§€, ê·¸ë¦¬ê³  ë°°ì†¡ì€ ì–¸ì œ ë˜ëŠ”ì§€ ì•Œê³  ì‹¶ìŠµë‹ˆë‹¤. ë¹ ë¥¸ ë‹µë³€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.`,
                    
                    'review': `ì´ ì œí’ˆ ì •ë§ ìµœê³ ì˜ˆìš”! ë°°ì†¡ë„ ë¹ ë¥´ê³ , í’ˆì§ˆë„ ê¸°ëŒ€ ì´ìƒì…ë‹ˆë‹¤. ê°€ê²© ëŒ€ë¹„ ì„±ëŠ¥ì´ ë„ˆë¬´ ì¢‹ì•„ì„œ ì¹œêµ¬ë“¤í•œí…Œë„ ì¶”ì²œí–ˆì–´ìš”. ë‹¤ë§Œ ì„¤ëª…ì„œê°€ ì¢€ ë¶€ì‹¤í•œ ê²ƒ ê°™ì•„ìš”. ê·¸ë˜ë„ ì „ë°˜ì ìœ¼ë¡œ ë§¤ìš° ë§Œì¡±í•©ë‹ˆë‹¤. ë‹¤ìŒì—ë„ ì´ ë¸Œëœë“œ ì œí’ˆì„ êµ¬ë§¤í•  ìƒê°ì…ë‹ˆë‹¤.`
                };
                
                document.getElementById('textInput').value = examples[type] || examples['article'];
                updateCharCount();
            }

            // ì´ˆê¸°í™”
            window.onload = function() {
                updateCharCount();
            };
        </script>
    </th:block>
</body>
</html>