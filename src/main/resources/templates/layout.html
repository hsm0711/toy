<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE">Playground</title>
    
    <!-- ê³µí†µ CSS -->
    <link rel="stylesheet" th:href="@{/css/common.css}">
    
    <!-- í˜ì´ì§€ë³„ CSS -->
    <th:block layout:fragment="extra-css"></th:block>
    <link rel="icon" type="image/svg+xml" th:href="@{/image/favicon.svg}">
</head>
<body>
    <!-- ëª¨ë°”ì¼ ë©”ë‰´ ì˜¤ë²„ë ˆì´ -->
    <div class="menu-overlay" id="menuOverlay"></div>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar">
        <div class="nav-container">
            <!-- ë¡œê³  -->
            <div class="nav-logo">
                <a th:href="@{/}" aria-label="í™ˆìœ¼ë¡œ ê°€ê¸°">ğŸ® Playground</a>
            </div>
            
            <!-- ë©”ë‰´ (PCì—ì„œ ì¤‘ì•™ ë°°ì¹˜) -->
            <div class="nav-menu" id="navMenu">
                <ul class="nav-list">
                    <th:block th:if="${menus != null and !menus.isEmpty()}">
                        <li th:each="menu : ${menus}" class="nav-item">
                            <a th:href="@{${menu.path}}" 
                               class="nav-link"
                               th:classappend="${(menu.path == '/' && currentPage == 'home') || (menu.path.length() > 1 && currentPage == menu.path.substring(1))} ? 'active' : ''"
                               th:attr="aria-current=${(menu.path == '/' && currentPage == 'home') || (menu.path.length() > 1 && currentPage == menu.path.substring(1))} ? 'page' : null">
                                <span th:if="${menu.icon != null and menu.icon != ''}" th:text="${menu.icon}" class="nav-icon"></span>
                                <span th:text="${menu.name}"></span>
                            </a>
                        </li>
                    </th:block>
                </ul>
            </div>
            
            <!-- ì˜¤ë¥¸ìª½ ë²„íŠ¼ë“¤ -->
            <div class="nav-actions">
                <!-- ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
                <button class="theme-toggle" id="themeToggle" aria-label="í…Œë§ˆ ì „í™˜">
                    <span class="theme-icon sun-icon">â˜€ï¸</span>
                    <span class="theme-icon moon-icon">ğŸŒ™</span>
                </button>
                
                <!-- í–„ë²„ê±° ë²„íŠ¼ (ëª¨ë°”ì¼) -->
                <button class="hamburger" id="hamburgerBtn" aria-label="ë©”ë‰´ ì—´ê¸°" aria-expanded="false">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content" role="main">
        <div layout:fragment="content">
            <!-- í˜ì´ì§€ë³„ ì»¨í…ì¸  -->
        </div>
    </main>

    <!-- í‘¸í„° -->
    <footer class="footer" role="contentinfo">
        <div class="footer-container">
            <p>&copy; <span th:text="${#dates.year(#dates.createNow())}">2024</span> Playground. All rights reserved.</p>
        </div>
    </footer>

    <!-- í…Œë§ˆ & ë©”ë‰´ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ë‹¤í¬ëª¨ë“œ ê´€ë¦¬
        (function() {
            'use strict';
            
            const themeToggle = document.getElementById('themeToggle');
            const html = document.documentElement;
            
            // ì €ì¥ëœ í…Œë§ˆ ë˜ëŠ” ì‹œìŠ¤í…œ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const initialTheme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
            
            // ì´ˆê¸° í…Œë§ˆ ì ìš©
            html.setAttribute('data-theme', initialTheme);
            updateThemeIcon(initialTheme);
            
            // í…Œë§ˆ í† ê¸€ ë²„íŠ¼ í´ë¦­
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    const currentTheme = html.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    html.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    updateThemeIcon(newTheme);
                });
            }
            
            // í…Œë§ˆ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            function updateThemeIcon(theme) {
                const sunIcon = themeToggle.querySelector('.sun-icon');
                const moonIcon = themeToggle.querySelector('.moon-icon');
                
                if (theme === 'dark') {
                    sunIcon.style.display = 'block';
                    moonIcon.style.display = 'none';
                } else {
                    sunIcon.style.display = 'none';
                    moonIcon.style.display = 'block';
                }
            }
            
            // ì‹œìŠ¤í…œ í…Œë§ˆ ë³€ê²½ ê°ì§€
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                if (!localStorage.getItem('theme')) {
                    const newTheme = e.matches ? 'dark' : 'light';
                    html.setAttribute('data-theme', newTheme);
                    updateThemeIcon(newTheme);
                }
            });
        })();
        
        // ëª¨ë°”ì¼ ë©”ë‰´ ê´€ë¦¬
        (function() {
            'use strict';
            
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const navMenu = document.getElementById('navMenu');
            const menuOverlay = document.getElementById('menuOverlay');
            const body = document.body;
            
            if (!hamburgerBtn || !navMenu || !menuOverlay) {
                console.warn('Menu elements not found');
                return;
            }
            
            // ë©”ë‰´ ì—´ê¸°
            function openMenu() {
                hamburgerBtn.classList.add('active');
                navMenu.classList.add('active');
                menuOverlay.classList.add('active');
                body.style.overflow = 'hidden';
                hamburgerBtn.setAttribute('aria-expanded', 'true');
                hamburgerBtn.setAttribute('aria-label', 'ë©”ë‰´ ë‹«ê¸°');
            }
            
            // ë©”ë‰´ ë‹«ê¸°
            function closeMenu() {
                hamburgerBtn.classList.remove('active');
                navMenu.classList.remove('active');
                menuOverlay.classList.remove('active');
                body.style.overflow = '';
                hamburgerBtn.setAttribute('aria-expanded', 'false');
                hamburgerBtn.setAttribute('aria-label', 'ë©”ë‰´ ì—´ê¸°');
            }
            
            // ë©”ë‰´ í† ê¸€
            function toggleMenu() {
                if (hamburgerBtn.classList.contains('active')) {
                    closeMenu();
                } else {
                    openMenu();
                }
            }
            
            // í–„ë²„ê±° ë²„íŠ¼ í´ë¦­
            hamburgerBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                toggleMenu();
            });
            
            // ì˜¤ë²„ë ˆì´ í´ë¦­ì‹œ ë‹«ê¸°
            menuOverlay.addEventListener('click', function() {
                closeMenu();
            });
            
            // ë©”ë‰´ ë§í¬ í´ë¦­ì‹œ ë‹«ê¸°
            const menuLinks = navMenu.querySelectorAll('.nav-link');
            menuLinks.forEach(function(link) {
                link.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        closeMenu();
                    }
                });
            });
            
            // ESC í‚¤ë¡œ ë‹«ê¸°
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && navMenu.classList.contains('active')) {
                    closeMenu();
                }
            });
            
            // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆì‹œ ë°ìŠ¤í¬íƒ‘ìœ¼ë¡œ ì „í™˜ë˜ë©´ ë©”ë‰´ ë‹«ê¸°
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    if (window.innerWidth > 768 && navMenu.classList.contains('active')) {
                        closeMenu();
                    }
                }, 100);
            });
        })();
        
        // ìŠ¤í¬ë¡¤ì‹œ navbar ê·¸ë¦¼ì íš¨ê³¼
        (function() {
            const navbar = document.querySelector('.navbar');
            if (!navbar) return;
            
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 10) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            }, { passive: true });
        })();
    </script>
    
    <th:block layout:fragment="extra-js"></th:block>
</body>
</html>