<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>AI vs AI í† ë¡  ë°°í‹€</title>
    <th:block layout:fragment="extra-css">
        <link rel="stylesheet" th:href="@{/css/tool-page.css}">
        <link rel="stylesheet" th:href="@{/css/components.css}">
        <style>
            .debate-container {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
                margin-top: 1rem;
            }
            .debate-input-section {
                display: flex;
                gap: 1rem;
                align-items: center;
            }
            textarea.form-control {
                flex-grow: 1;
                resize: vertical;
                font-size: 0.95rem;
                min-height: 80px;
                max-height: 200px;
            }
            .debate-log {
                background-color: #f8f9fa;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                padding: 1rem;
                min-height: 300px;
                max-height: 600px;
                overflow-y: auto;
                font-size: 0.9rem;
                line-height: 1.6;
            }
            .debate-message {
                margin-bottom: 0.8rem;
                padding: 0.6rem 1rem;
                border-radius: 6px;
            }
            .debate-message.ai1 {
                background-color: #e6f7ff; /* Light blue */
                text-align: left;
            }
            .debate-message.ai2 {
                background-color: #fff0f6; /* Light pink */
                text-align: right;
            }
            .debate-message strong {
                display: block;
                margin-bottom: 0.3rem;
                font-size: 1rem;
            }
            .streaming-indicator {
                display: none;
                align-items: center;
                gap: 0.5rem;
                color: #667eea;
                font-weight: 500;
                margin-top: 1rem;
            }
            .streaming-indicator.show {
                display: flex;
            }
            .streaming-dot {
                width: 8px;
                height: 8px;
                background: #667eea;
                border-radius: 50%;
                animation: pulse 1.5s infinite;
            }
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.3; }
            }
        </style>
    </th:block>
</head>
<body>
<div layout:fragment="content">
    <div class="tool-container">
        <div class="page-header">
            <h2>ğŸ¤– AI vs AI í† ë¡  ë°°í‹€</h2>
            <p class="description">ë‘ AI ëª¨ë¸ì´ íŠ¹ì • ì£¼ì œì— ëŒ€í•´ í† ë¡ í•˜ëŠ” ê³¼ì •ì„ ì§€ì¼œë´…ë‹ˆë‹¤.</p>
        </div>

        <div class="tool-section card">
            <div class="debate-container">
                <div class="debate-input-section">
                    <textarea id="debateTopic" class="form-control" placeholder="í† ë¡  ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: í”¼ìì— íŒŒì¸ì• í”Œì€ ìœ í•´í•œê°€?)..."></textarea>
                    <div style="width: 120px;">
                        <label for="debateTurns" class="form-label visually-hidden">í† ë¡  í„´ ìˆ˜</label>
                        <select id="debateTurns" class="form-select">
                            <option value="3">3 í„´</option>
                            <option value="5" selected>5 í„´</option>
                            <option value="7">7 í„´</option>
                            <option value="10">10 í„´</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="startDebate()" id="startDebateBtn">
                        ğŸ”¥ í† ë¡  ì‹œì‘
                    </button>
                </div>
                
                <div class="streaming-indicator" id="streamingIndicator">
                    <div class="streaming-dot"></div>
                    <span>AIë“¤ì´ ì—´ë¤ í† ë¡  ì¤‘ì…ë‹ˆë‹¤...</span>
                </div>

                <div id="debateLog" class="debate-log">
                    <!-- Debate messages will be inserted here -->
                    <p>í† ë¡ ì„ ì‹œì‘í•˜ë ¤ë©´ ì£¼ì œë¥¼ ì…ë ¥í•˜ê³  'í† ë¡  ì‹œì‘' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                </div>
                
                <div id="errorMessage" class="error-message"></div>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="extra-js">
    <script th:src="@{/js/common-utils.js}"></script>
    <script>
        async function startDebate() {
            const topic = document.getElementById('debateTopic').value.trim();
            const turns = document.getElementById('debateTurns').value; // Get the turns value

            if (!topic) {
                UiUtils.showError('í† ë¡  ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const startDebateBtn = document.getElementById('startDebateBtn');
            const streamingIndicator = document.getElementById('streamingIndicator');
            const debateLog = document.getElementById('debateLog');

            debateLog.innerHTML = ''; // Clear previous debate
            UiUtils.hideError();
            startDebateBtn.disabled = true;
            startDebateBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> í† ë¡  ì¤€ë¹„ ì¤‘...';
            streamingIndicator.classList.add('show');

            try {
                const response = await fetch('/ai-debate/api/start-debate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic: topic, turns: turns }), // Include turns in the request body
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    debateLog.innerHTML = ''; // Clear initial message
                    data.result.forEach(turn => {
                        const isAI1 = turn.speaker === "AI 1";
                        addDebateMessage(turn.speaker, turn.message, isAI1);
                    });
                    UiUtils.showSuccess('AI í† ë¡ ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    UiUtils.showError(data.message || 'í† ë¡  ì‹œì‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('API ì˜¤ë¥˜:', error);
                UiUtils.showError('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ë¬¸ì œ ë°œìƒ');
            } finally {
                startDebateBtn.disabled = false;
                startDebateBtn.innerHTML = 'ğŸ”¥ í† ë¡  ì‹œì‘';
                streamingIndicator.classList.remove('show');
            }
        }
        
        function addDebateMessage(sender, message, isAI1) {
            const debateLog = document.getElementById('debateLog');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('debate-message');
            messageDiv.classList.add(isAI1 ? 'ai1' : 'ai2');
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
            debateLog.appendChild(messageDiv);
            debateLog.scrollTop = debateLog.scrollHeight; // Scroll to bottom
        }
    </script>
</th:block>
</body>
</html>
