<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>í¬íŠ¸/URL ì²´í¬</title>
    <th:block layout:fragment="extra-css">
        <link rel="stylesheet" th:href="@{/css/tool-page.css}">
        <link rel="stylesheet" th:href="@{/css/components.css}">
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <div class="tool-container">
            <div class="page-header">
                <h2>ğŸ” í¬íŠ¸ ì²´í¬ / URL í—¬ìŠ¤ì²´í¬</h2>
                <p class="description">TCP í¬íŠ¸ ì—´ë¦¼ ìƒíƒœì™€ HTTP URLì˜ ì‘ë‹µ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
            </div>

            <!-- Port Check -->
            <div class="tool-section card">
                <h3>í¬íŠ¸ ì²´í¬</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>í˜¸ìŠ¤íŠ¸ (IP ë˜ëŠ” ë„ë©”ì¸)</label>
                        <input type="text" id="portHost" placeholder="ì˜ˆ: google.com ë˜ëŠ” 8.8.8.8">
                    </div>
                    <div class="input-group">
                        <label>í¬íŠ¸</label>
                        <input type="number" id="portNumber" placeholder="80" min="1" max="65535">
                    </div>
                </div>
                <div class="input-group">
                    <label>íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ)</label>
                    <input type="number" id="portTimeout" value="5000" min="1000" max="30000">
                </div>
                <button class="btn btn-primary" onclick="checkPort()">í¬íŠ¸ ì²´í¬</button>
                <div class="loading" id="portLoading">ğŸ”„ ì²´í¬ ì¤‘...</div>
                <div id="portResult" class="result-box"></div>
            </div>

            <!-- URL Health Check -->
            <div class="tool-section card">
                <h3>URL í—¬ìŠ¤ì²´í¬</h3>
                <div class="input-group">
                    <label>URL</label>
                    <input type="text" id="urlInput" placeholder="ì˜ˆ: https://google.com">
                </div>
                <div class="input-group">
                    <label>íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ)</label>
                    <input type="number" id="urlTimeout" value="5000" min="1000" max="30000">
                </div>
                <button class="btn btn-primary" onclick="checkUrl()">URL ì²´í¬</button>
                <div class="loading" id="urlLoading">ğŸ”„ ì²´í¬ ì¤‘...</div>
                <div id="urlResult" class="result-box"></div>
            </div>

            <div class="examples" style="background: #fff3cd;">
                <h4 style="color: #856404;">ìì£¼ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸</h4>
                <div class="example-item">HTTP: 80, HTTPS: 443</div>
                <div class="example-item">SSH: 22, FTP: 21, Telnet: 23</div>
                <div class="example-item">SMTP: 25, POP3: 110, IMAP: 143</div>
                <div class="example-item">MySQL: 3306, PostgreSQL: 5432, MongoDB: 27017</div>
                <div class="example-item">Redis: 6379, RabbitMQ: 5672</div>
            </div>
            
            <div id="errorMessage" class="error-message"></div>
        </div>
    </div>

    <th:block layout:fragment="extra-js">
        <script th:src="@{/js/common-utils.js}"></script>
        
        <script>
            async function checkPort() {
                const host = document.getElementById('portHost').value;
                const port = document.getElementById('portNumber').value;
                const timeout = document.getElementById('portTimeout').value;
                const resultDiv = document.getElementById('portResult');
                const loadingDiv = document.getElementById('portLoading');
                
                if (!ValidationUtils.validateRequired('portHost', 'í˜¸ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.')) {
                    return;
                }
                
                if (!ValidationUtils.validateRequired('portNumber', 'í¬íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.')) {
                    return;
                }
                
                if (!ValidationUtils.validateRange(port, 1, 65535)) {
                    UiUtils.showError('í¬íŠ¸ëŠ” 1~65535 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }
                
                UiUtils.hideError();
                UiUtils.showLoading('portLoading');
                UiUtils.hide('portResult');
                
                try {
                    const params = new URLSearchParams({ host, port, timeout });
                    const data = await ApiClient.postForm('/health-check/api/port-check', params);
                    
                    if (data.success) {
                        const statusClass = data.isOpen ? 'status-open' : 'status-closed';
                        resultDiv.innerHTML = `
                            <div class="result-item">
                                <span class="result-label">í˜¸ìŠ¤íŠ¸:í¬íŠ¸</span>
                                <span class="result-value">${data.host}:${data.port}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ìƒíƒœ</span>
                                <span class="status-badge ${statusClass}">${data.status}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ì‘ë‹µ ì‹œê°„</span>
                                <span class="result-value">${data.responseTime} ms</span>
                            </div>
                        `;
                        UiUtils.show('portResult');
                    } else {
                        UiUtils.showError(data.message);
                    }
                } catch (error) {
                    console.error('í¬íŠ¸ ì²´í¬ ì˜¤ë¥˜:', error);
                    UiUtils.showError('ì²´í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    UiUtils.hideLoading('portLoading');
                }
            }

            async function checkUrl() {
                const url = document.getElementById('urlInput').value;
                const timeout = document.getElementById('urlTimeout').value;
                const resultDiv = document.getElementById('urlResult');
                const loadingDiv = document.getElementById('urlLoading');
                
                if (!ValidationUtils.validateRequired('urlInput', 'URLì„ ì…ë ¥í•˜ì„¸ìš”.')) {
                    return;
                }
                
                UiUtils.hideError();
                UiUtils.showLoading('urlLoading');
                UiUtils.hide('urlResult');
                
                try {
                    const params = new URLSearchParams({ url, timeout });
                    const data = await ApiClient.postForm('/health-check/api/url-check', params);
                    
                    if (data.success) {
                        const statusClass = data.isSuccess ? 'status-success' : 'status-error';
                        resultDiv.innerHTML = `
                            <div class="result-item">
                                <span class="result-label">URL</span>
                                <span class="result-value">${HtmlUtils.escape(data.url)}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">HTTP ìƒíƒœ</span>
                                <span class="status-badge ${statusClass}">${data.statusCode || 'N/A'}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ìƒíƒœ í…ìŠ¤íŠ¸</span>
                                <span class="result-value">${HtmlUtils.escape(data.statusText)}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ì‘ë‹µ ì‹œê°„</span>
                                <span class="result-value">${data.responseTime} ms</span>
                            </div>
                        `;
                        UiUtils.show('urlResult');
                    } else {
                        UiUtils.showError(data.message);
                    }
                } catch (error) {
                    console.error('URL ì²´í¬ ì˜¤ë¥˜:', error);
                    UiUtils.showError('ì²´í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    UiUtils.hideLoading('urlLoading');
                }
            }
        </script>
    </th:block>
</body>
</html>