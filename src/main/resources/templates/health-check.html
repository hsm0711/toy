<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>í¬íŠ¸/URL ì²´í¬</title>
    <th:block layout:fragment="extra-css">
        <link rel="stylesheet" th:href="@{/css/tool-page.css}">
        <style>
            .examples {
                background: #fff3cd;
            }
            .examples h4 {
                color: #856404;
            }
        </style>
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <div class="tool-container">
            <div class="page-header">
                <h2>ğŸ” í¬íŠ¸ ì²´í¬ / URL í—¬ìŠ¤ì²´í¬</h2>
                <p class="description">TCP í¬íŠ¸ ì—´ë¦¼ ìƒíƒœì™€ HTTP URLì˜ ì‘ë‹µ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
            </div>

            <!-- Port Check -->
            <div class="tool-section">
                <h3>í¬íŠ¸ ì²´í¬</h3>
                <div class="input-row">
                    <div class="input-group">
                        <label>í˜¸ìŠ¤íŠ¸ (IP ë˜ëŠ” ë„ë©”ì¸)</label>
                        <input type="text" id="portHost" placeholder="ì˜ˆ: google.com ë˜ëŠ” 8.8.8.8">
                    </div>
                    <div class="input-group">
                        <label>í¬íŠ¸</label>
                        <input type="number" id="portNumber" placeholder="80" min="1" max="65535">
                    </div>
                </div>
                <div class="input-group">
                    <label>íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ)</label>
                    <input type="number" id="portTimeout" value="5000" min="1000" max="30000">
                </div>
                <button class="btn btn-primary" onclick="checkPort()">í¬íŠ¸ ì²´í¬</button>
                <div class="loading" id="portLoading">ğŸ”„ ì²´í¬ ì¤‘...</div>
                <div id="portResult" class="result-box"></div>
            </div>

            <!-- URL Health Check -->
            <div class="tool-section">
                <h3>URL í—¬ìŠ¤ì²´í¬</h3>
                <div class="input-group">
                    <label>URL</label>
                    <input type="text" id="urlInput" placeholder="ì˜ˆ: https://google.com">
                </div>
                <div class="input-group">
                    <label>íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ)</label>
                    <input type="number" id="urlTimeout" value="5000" min="1000" max="30000">
                </div>
                <button class="btn btn-primary" onclick="checkUrl()">URL ì²´í¬</button>
                <div class="loading" id="urlLoading">ğŸ”„ ì²´í¬ ì¤‘...</div>
                <div id="urlResult" class="result-box"></div>
            </div>

            <div class="examples">
                <h4>ìì£¼ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸</h4>
                <div class="example-item">HTTP: 80, HTTPS: 443</div>
                <div class="example-item">SSH: 22, FTP: 21, Telnet: 23</div>
                <div class="example-item">SMTP: 25, POP3: 110, IMAP: 143</div>
                <div class="example-item">MySQL: 3306, PostgreSQL: 5432, MongoDB: 27017</div>
                <div class="example-item">Redis: 6379, RabbitMQ: 5672</div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="extra-js">
        <script>
            async function checkPort() {
                const host = document.getElementById('portHost').value;
                const port = document.getElementById('portNumber').value;
                const timeout = document.getElementById('portTimeout').value;
                const resultDiv = document.getElementById('portResult');
                const loadingDiv = document.getElementById('portLoading');
                
                if (!host || !port) {
                    alert('í˜¸ìŠ¤íŠ¸ì™€ í¬íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                
                loadingDiv.classList.add('show');
                resultDiv.classList.remove('show');
                
                try {
                    const response = await fetch('/health-check/api/port-check', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: `host=${encodeURIComponent(host)}&port=${port}&timeout=${timeout}`
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        const statusClass = data.isOpen ? 'status-open' : 'status-closed';
                        resultDiv.innerHTML = `
                            <div class="result-item">
                                <span class="result-label">í˜¸ìŠ¤íŠ¸:í¬íŠ¸</span>
                                <span class="result-value">${data.host}:${data.port}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ìƒíƒœ</span>
                                <span class="status-badge ${statusClass}">${data.status}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ì‘ë‹µ ì‹œê°„</span>
                                <span class="result-value">${data.responseTime} ms</span>
                            </div>
                        `;
                        resultDiv.classList.add('show');
                    } else {
                        alert('ì²´í¬ ì‹¤íŒ¨: ' + data.message);
                    }
                } catch (error) {
                    console.error('í¬íŠ¸ ì²´í¬ ì˜¤ë¥˜:', error);
                    alert('ì²´í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    loadingDiv.classList.remove('show');
                }
            }

            async function checkUrl() {
                const url = document.getElementById('urlInput').value;
                const timeout = document.getElementById('urlTimeout').value;
                const resultDiv = document.getElementById('urlResult');
                const loadingDiv = document.getElementById('urlLoading');
                
                if (!url) {
                    alert('URLì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                
                loadingDiv.classList.add('show');
                resultDiv.classList.remove('show');
                
                try {
                    const response = await fetch('/health-check/api/url-check', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: `url=${encodeURIComponent(url)}&timeout=${timeout}`
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        const statusClass = data.isSuccess ? 'status-success' : 'status-error';
                        resultDiv.innerHTML = `
                            <div class="result-item">
                                <span class="result-label">URL</span>
                                <span class="result-value">${data.url}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">HTTP ìƒíƒœ</span>
                                <span class="status-badge ${statusClass}">${data.statusCode || 'N/A'}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ìƒíƒœ í…ìŠ¤íŠ¸</span>
                                <span class="result-value">${data.statusText}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ì‘ë‹µ ì‹œê°„</span>
                                <span class="result-value">${data.responseTime} ms</span>
                            </div>
                        `;
                        resultDiv.classList.add('show');
                    } else {
                        alert('ì²´í¬ ì‹¤íŒ¨: ' + data.message);
                    }
                } catch (error) {
                    console.error('URL ì²´í¬ ì˜¤ë¥˜:', error);
                    alert('ì²´í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    loadingDiv.classList.remove('show');
                }
            }
        </script>
    </th:block>
</body>
</html>