<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Timestamp ë³€í™˜</title>
    <th:block layout:fragment="extra-css">
        <link rel="stylesheet" th:href="@{/css/tool-page.css}">
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <div class="tool-container">
            <div class="page-header">
                <h2>ğŸ• Timestamp ë³€í™˜ê¸°</h2>
                <p class="description">Unix Timestampì™€ ë‚ ì§œ/ì‹œê°„ì„ ìƒí˜¸ ë³€í™˜í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="current-time-box">
                <h3>í˜„ì¬ ì‹œê°„</h3>
                <div id="currentTimeDisplay">ë¡œë”© ì¤‘...</div>
                <button class="btn btn-secondary" onclick="refreshCurrentTime()" style="margin-top: 0.5rem;">ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <!-- Timestamp to DateTime -->
            <div class="tool-section">
                <h3>Timestamp â†’ ë‚ ì§œ/ì‹œê°„</h3>
                <div class="input-group">
                    <label>Timestamp ì…ë ¥</label>
                    <input type="number" id="timestampInput" placeholder="ì˜ˆ: 1234567890">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="isMillis">
                    <label for="isMillis" style="margin-bottom: 0;">ë°€ë¦¬ì´ˆ ë‹¨ìœ„</label>
                </div>
                <div class="input-group">
                    <label>íƒ€ì„ì¡´ ì„ íƒ</label>
                    <select id="timezone1">
                        <option value="UTC">UTC</option>
                        <option value="Asia/Seoul" selected>KST (Asia/Seoul)</option>
                        <option value="America/New_York">EST (America/New_York)</option>
                        <option value="America/Los_Angeles">PST (America/Los_Angeles)</option>
                        <option value="Europe/London">GMT (Europe/London)</option>
                        <option value="Asia/Tokyo">JST (Asia/Tokyo)</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="convertFromTimestamp()">ë³€í™˜í•˜ê¸°</button>
                <div id="result1" class="result-box"></div>
            </div>

            <!-- DateTime to Timestamp -->
            <div class="tool-section">
                <h3>ë‚ ì§œ/ì‹œê°„ â†’ Timestamp</h3>
                <div class="input-group">
                    <label>ë‚ ì§œ/ì‹œê°„ ì…ë ¥</label>
                    <input type="datetime-local" id="datetimeInput">
                </div>
                <div class="input-group">
                    <label>íƒ€ì„ì¡´ ì„ íƒ</label>
                    <select id="timezone2">
                        <option value="UTC">UTC</option>
                        <option value="Asia/Seoul" selected>KST (Asia/Seoul)</option>
                        <option value="America/New_York">EST (America/New_York)</option>
                        <option value="America/Los_Angeles">PST (America/Los_Angeles)</option>
                        <option value="Europe/London">GMT (Europe/London)</option>
                        <option value="Asia/Tokyo">JST (Asia/Tokyo)</option>
                    </select>
                </div>
                <div class="btn-row">
                    <button class="btn btn-primary" onclick="convertFromDateTime()">ë³€í™˜í•˜ê¸°</button>
                    <button class="btn btn-secondary" onclick="setNow()">í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì„¤ì •</button>
                </div>
                <div id="result2" class="result-box"></div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="extra-js">
        <script>
            window.onload = function() { refreshCurrentTime(); };

            async function refreshCurrentTime() {
                try {
                    const response = await fetch('/timestamp/api/current?timezone=Asia/Seoul');
                    const data = await response.json();
                    if (data.success) {
                        document.getElementById('currentTimeDisplay').innerHTML = `
                            <strong>${data.readable}</strong><br>
                            <small>Timestamp (ì´ˆ): ${data.timestampSeconds}</small><br>
                            <small>Timestamp (ë°€ë¦¬ì´ˆ): ${data.timestampMillis}</small>
                        `;
                    }
                } catch (error) {
                    console.error('í˜„ì¬ ì‹œê°„ ì¡°íšŒ ì‹¤íŒ¨:', error);
                }
            }

            async function convertFromTimestamp() {
                const timestamp = document.getElementById('timestampInput').value;
                const timezone = document.getElementById('timezone1').value;
                const isMillis = document.getElementById('isMillis').checked;
                const resultDiv = document.getElementById('result1');
                
                if (!timestamp) {
                    alert('Timestampë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                
                try {
                    const response = await fetch('/timestamp/api/convert', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: `timestamp=${timestamp}&timezone=${timezone}&isMillis=${isMillis}`
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        resultDiv.innerHTML = `
                            <div class="result-item">
                                <span class="result-label">ë‚ ì§œ/ì‹œê°„:</span>
                                <span class="result-value">${data.dateTime}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ISO 8601:</span>
                                <span class="result-value">${data.iso8601}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ì½ê¸° ì‰¬ìš´ í˜•ì‹:</span>
                                <span class="result-value">${data.readable}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Timestamp (ì´ˆ):</span>
                                <span class="result-value">${data.timestampSeconds}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Timestamp (ë°€ë¦¬ì´ˆ):</span>
                                <span class="result-value">${data.timestampMillis}</span>
                            </div>
                        `;
                        resultDiv.classList.add('show');
                    } else {
                        alert('ë³€í™˜ ì‹¤íŒ¨: ' + data.message);
                    }
                } catch (error) {
                    console.error('ë³€í™˜ ì˜¤ë¥˜:', error);
                    alert('ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }

            async function convertFromDateTime() {
                const dateTime = document.getElementById('datetimeInput').value;
                const timezone = document.getElementById('timezone2').value;
                const resultDiv = document.getElementById('result2');
                
                if (!dateTime) {
                    alert('ë‚ ì§œ/ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                
                try {
                    const response = await fetch('/timestamp/api/convert', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: `dateTime=${dateTime}&timezone=${timezone}`
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        resultDiv.innerHTML = `
                            <div class="result-item">
                                <span class="result-label">Timestamp (ì´ˆ):</span>
                                <span class="result-value">${data.timestampSeconds}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Timestamp (ë°€ë¦¬ì´ˆ):</span>
                                <span class="result-value">${data.timestampMillis}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ISO 8601:</span>
                                <span class="result-value">${data.iso8601}</span>
                            </div>
                        `;
                        resultDiv.classList.add('show');
                    } else {
                        alert('ë³€í™˜ ì‹¤íŒ¨: ' + data.message);
                    }
                } catch (error) {
                    console.error('ë³€í™˜ ì˜¤ë¥˜:', error);
                    alert('ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }

            function setNow() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                document.getElementById('datetimeInput').value = `${year}-${month}-${day}T${hours}:${minutes}`;
            }
        </script>
    </th:block>
</body>
</html>